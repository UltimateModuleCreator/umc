<?xml version="1.0"?>{{ module.getFormattedLicense('xml')|raw }}
<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:framework:ObjectManager/etc/config.xsd">
{% for entity in module.getEntities() %}
    <preference for="{{ entity.getRepoInterface() }}" type="{{ entity.getRepoModel() }}"/>
    <preference for="{{ entity.getListRepoInterface() }}" type="{{ entity.getListRepoModel() }}"/>
    <preference for="{{ entity.getInterface() }}" type="{{ entity.getModel() }}"/>
    <preference for="{{ entity.getSearchResultsInterface() }}" type="Magento\Framework\Api\SearchResults"/>
{% endfor %}
    <type name="Magento\Framework\EntityManager\MetadataPool">
        <arguments>
            <argument name="metadata" xsi:type="array">
{% for entity in module.getEntities() %}
                <item name="{{ module.getNamespace() }}\{{module.getModuleName() }}\Api\Data\{{ entity.getNameSingular()|camel|ucfirst }}Interface" xsi:type="array">
                    <item name="entityTableName" xsi:type="string">{{ entity.getMainTableName() }}</item>
                    <item name="identifierField" xsi:type="string">{{ entity.getPk() }}</item>
                </item>
{% endfor %}
            </argument>
        </arguments>
    </type>
{% if module.hasSearchableEntities() %}
    <type name="Magento\Backend\Controller\Adminhtml\Index\GlobalSearch">
        <arguments>
            <argument name="searchModules" xsi:type="array">
{% for entity in module.getSearchableEntities() %}
                <item name="{{ module.getNamespace()|snake }}_{{module.getModuleName()|snake }}_{{ entity.getNameSingular()|snake }}" xsi:type="array">
                    <item name="class" xsi:type="string">{{ entity.getSearchModel() }}</item>
                    <item name="acl" xsi:type="string">{{ entity.getAclName() }}</item>
                </item>
{% endfor %}
            </argument>
        </arguments>
    </type>
{% endif %}
    <!-- configure resource models -->
{% for entity in module.getEntities() %}
    <type name="{{ entity.getResourceModel() }}">
        <arguments>
{% if entity.isStore() %}
            <argument name="storeTable" xsi:type="string">{{ entity.getStoreTableName() }}</argument>
{% endif %}
            <argument name="interfaceClass" xsi:type="string">{{ entity.getInterface() }}</argument>
        </arguments>
    </type>
{% endfor %}
    <type name="Magento\Framework\View\Element\UiComponent\DataProvider\CollectionFactory">
        <arguments>
            <argument name="collections" xsi:type="array">
{% for entity in module.getEntities() %}
                <item name="{{module.getModuleName()|camel|lower }}_{{ entity.getNameSingular()|camel|lower }}_listing_data_source" xsi:type="string">{{ module.getNamespace() }}{{module.getModuleName() }}{{ entity.getNameSingular()|camel|ucfirst }}GridCollection</item>
{% endfor %}
            </argument>
        </arguments>
    </type>
{% for entity in module.getEntities() %}
    <type name="{{ entity.getCollectionModel() }}">
        <arguments>
            <argument name="mainTable" xsi:type="string">{{ entity.getMainTableName() }}</argument>
            <argument name="model" xsi:type="string">{{ entity.getModel() }}</argument>
            <argument name="resourceModel" xsi:type="string">{{ entity.getResourceModel() }}</argument>
            <argument name="idFieldName" xsi:type="string">{{ entity.getPk() }}</argument>
            <argument name="eventPrefix" xsi:type="string">{{ entity.getEventPrefix()}}_collection</argument>
            <argument name="eventObject" xsi:type="string">{{ entity.getNameSingular()|snake }}_collection</argument>
            <argument name="interfaceClass" xsi:type="string">{{ entity.getInterface() }}</argument>
{% if entity.isStore() %}
                <argument name="storeTable" xsi:type="string">{{ entity.getStoreTableName() }}</argument>
{% endif %}
        </arguments>
    </type>
    <virtualType name="{{ module.getNamespace() }}{{module.getModuleName()|camel|ucfirst }}{{ entity.getNameSingular()|camel|ucfirst }}GridCollection" type="{{ module.getNamespace() }}\{{module.getModuleName() }}\Model\ResourceModel\{{ entity.getNameSingular()|camel|ucfirst }}\Collection">
        <arguments>
            <argument name="mainTable" xsi:type="string">{{ entity.getMainTableName() }}</argument>
            <argument name="model" xsi:type="string">Magento\Framework\View\Element\UiComponent\DataProvider\Document</argument>
            <argument name="resourceModel" xsi:type="string">{{ entity.getResourceModel() }}</argument>
            <argument name="idFieldName" xsi:type="string">{{ entity.getPk() }}</argument>
            <argument name="eventPrefix" xsi:type="string">{{ entity.getEventPrefix() }}_collection</argument>
            <argument name="eventObject" xsi:type="string">{{ entity.getNameSingular()|snake }}_collection</argument>
            <argument name="interfaceClass" xsi:type="string">{{ entity.getInterface() }}</argument>
{% if entity.isStore() %}
                <argument name="storeTable" xsi:type="string">{{ entity.getStoreTableName() }}</argument>
{% endif %}
        </arguments>
    </virtualType>
{% endfor %}
{% if module.hasAttributeType('wysiwyg') and module.isFrontend() %}
    <type name="{{ module.getNamespace() }}\{{module.getModuleName() }}\Model\Output">
        <arguments>
            <argument name="templateProcessor" xsi:type="object">Magento\Widget\Model\Template\Filter</argument>
        </arguments>
    </type>
{% endif %}
{% for entity in module.getStoreEntities() %}
    <virtualType name="{{ entity.getStoreHandler('Read') }}" type="{{ module.getUmcCrudNamespace() }}\{{ module.getUmcModuleName() }}\Model\ResourceModel\Relation\Store\ReadHandler">
        <arguments>
            <argument name="resource" xsi:type="object">{{ entity.getResourceModel() }}</argument>
        </arguments>
    </virtualType>
    <virtualType name="{{ entity.getStoreHandler('Save') }}" type="{{ module.getUmcCrudNamespace() }}\{{ module.getUmcModuleName() }}\Model\ResourceModel\Relation\Store\SaveHandler">
        <arguments>
            <argument name="resource" xsi:type="object">{{ entity.getResourceModel() }}</argument>
            <argument name="entityType" xsi:type="string">{{ entity.getInterface() }}</argument>
            <argument name="storeTable" xsi:type="string">{{ entity.getStoreTableName() }}</argument>
        </arguments>
    </virtualType>
{% endfor %}
{% if module.isStore() %}
    <type name="Magento\Framework\EntityManager\Operation\ExtensionPool">
        <arguments>
            <argument name="extensionActions" xsi:type="array">
{% for entity in module.getStoreEntities() %}
                <item name="{{ entity.getInterface() }}" xsi:type="array">
                    <item name="read" xsi:type="array">
                        <item name="storeReader" xsi:type="string">{{ entity.getStoreHandler('Read') }}</item>
                    </item>
                    <item name="create" xsi:type="array">
                        <item name="storeCreator" xsi:type="string">{{ entity.getStoreHandler('Save') }}</item>
                    </item>
                    <item name="update" xsi:type="array">
                        <item name="storeUpdater" xsi:type="string">{{ entity.getStoreHandler('Save') }}</item>
                    </item>
                </item>
{% endfor %}
            </argument>
        </arguments>
    </type>
{% endif %}
{% for entity in module.getImageEntities() %}
    <virtualType name="{{ entity.getUploadInfoModel('Image') }}" type="{{ module.getUmcCrudNamespace() }}\{{ module.getUmcModuleName() }}\Model\FileInfo">
        <arguments>
            <argument name="filePath" xsi:type="string">{{ entity.getUploadFolder('image') }}</argument>
        </arguments>
    </virtualType>
{% endfor %}
{% for entity in module.getFileEntities() %}
    <virtualType name="{{ entity.getUploadInfoModel('File') }}" type="{{ module.getUmcCrudNamespace() }}\{{ module.getUmcModuleName() }}\Model\FileInfo">
        <arguments>
            <argument name="filePath" xsi:type="string">{{ entity.getUploadFolder('file') }}</argument>
        </arguments>
    </virtualType>
{% endfor %}
{% for entity in module.getEntities() %}
{% for attribute in entity.getOptionAttributes() %}
    <virtualType name="{{ attribute.getOptionSourceVirtualType() }}" type="{{ module.getUmcCrudNamespace() }}\{{ module.getUmcModuleName() }}\Source\Options">
        <arguments>
            <argument name="options" xsi:type="array">
{% for option in attribute.getOptions() %}
                <item name="{{ option.getValue() }}" xsi:type="array">
                    <item name="value" xsi:type="{{ attribute.getOptionType() }}">{{ option.getValue() }}</item>
                    <item name="label" xsi:type="string" translatable="true">{{ option.getLabel() }}</item>
                </item>
{% endfor %}
            </argument>
        </arguments>
    </virtualType>
{% endfor %}
{% for attribute in entity.getSerializedAttributes() %}
{% for serialized in attribute.getSerializedWithOptions() %}
    <virtualType name="{{ serialized.getOptionSourceVirtualType() }}" type="{{ module.getUmcCrudNamespace() }}\{{ module.getUmcModuleName() }}\Source\Options">
        <arguments>
            <argument name="options" xsi:type="array">
                {% for option in serialized.getOptions() %}
                    <item name="{{ option.getValue() }}" xsi:type="array">
                        <item name="value" xsi:type="{{ attribute.getOptionType() }}">{{ option.getValue() }}</item>
                        <item name="label" xsi:type="string" translatable="true">{{ option.getLabel() }}</item>
                    </item>
                {% endfor %}
            </argument>
        </arguments>
    </virtualType>
{% endfor %}
{% endfor %}
{% endfor %}
</config>
